import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# Load dataset
df_day = pd.read_csv("day.csv")
df_hour = pd.read_csv("hour.csv")

# Mapping untuk season dan cuaca
season_mapping = {1: "Winter", 2: "Spring", 3: "Summer", 4: "Fall"}
weather_mapping = {1: "Cerah", 2: "Berawan", 3: "Hujan Ringan", 4: "Hujan Lebat"}

df_day["season_label"] = df_day["season"].map(season_mapping)
df_day["weather_label"] = df_day["weathersit"].map(weather_mapping)

# Sidebar - Filter Rentang Tanggal
st.sidebar.header("Filter Data")
start_date = st.sidebar.date_input("Mulai Tanggal", pd.to_datetime(df_day["dteday"]).min())
end_date = st.sidebar.date_input("Sampai Tanggal", pd.to_datetime(df_day["dteday"]).max())

# Filter dataset berdasarkan tanggal
df_day["dteday"] = pd.to_datetime(df_day["dteday"])
filtered_df = df_day[(df_day["dteday"] >= start_date) & (df_day["dteday"] <= end_date)]

# Header Dashboard
st.title("Dashboard Analisis Penyewaan Sepeda ğŸš´â€â™‚ï¸")
st.write(f"Menampilkan data dari **{start_date}** hingga **{end_date}**")

# **1. Tren Penyewaan Sepeda Harian**
st.subheader("ğŸ“Š Tren Penyewaan Sepeda Harian")
fig, ax = plt.subplots(figsize=(12, 6))
sns.lineplot(data=filtered_df, x="dteday", y="cnt", marker="o", color="b", ax=ax)
ax.set_xlabel("Tanggal")
ax.set_ylabel("Jumlah Penyewaan")
st.pyplot(fig)

# **2. Rata-rata Penyewaan Berdasarkan Musim**
st.subheader("ğŸŒ¦ï¸ Rata-rata Penyewaan Sepeda Berdasarkan Musim")
season_avg = filtered_df.groupby("season_label")["cnt"].mean().reset_index()
fig, ax = plt.subplots(figsize=(10, 6))
sns.barplot(data=season_avg, x="season_label", y="cnt", palette="coolwarm", ax=ax)
ax.set_xlabel("Musim")
ax.set_ylabel("Rata-rata Penyewaan")
st.pyplot(fig)

# **3. Penyewaan Sepeda Berdasarkan Cuaca**
st.subheader("â˜ï¸ Penyewaan Sepeda Berdasarkan Kondisi Cuaca")
weather_avg = filtered_df.groupby("weather_label")["cnt"].mean().reset_index()
fig, ax = plt.subplots(figsize=(10, 6))
sns.barplot(data=weather_avg, x="weather_label", y="cnt", palette="viridis", ax=ax)
ax.set_xlabel("Kondisi Cuaca")
ax.set_ylabel("Rata-rata Penyewaan")
st.pyplot(fig)

# **4. Pola Penyewaan Berdasarkan Hari dalam Seminggu**
st.subheader("ğŸ“… Pola Penyewaan Berdasarkan Hari dalam Seminggu")
day_mapping = {0: "Sunday", 1: "Monday", 2: "Tuesday", 3: "Wednesday", 
               4: "Thursday", 5: "Friday", 6: "Saturday"}
filtered_df["weekday_label"] = filtered_df["weekday"].map(day_mapping)
weekly_avg = filtered_df.groupby("weekday_label")["cnt"].mean().reindex(
    ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"])
fig, ax = plt.subplots(figsize=(10, 6))
sns.barplot(x=weekly_avg.index, y=weekly_avg.values, palette="Blues", ax=ax)
ax.set_xlabel("Hari")
ax.set_ylabel("Rata-rata Penyewaan")
st.pyplot(fig)

# **5. Hubungan Suhu dan Penyewaan Sepeda**
st.subheader("ğŸŒ¡ï¸ Hubungan Suhu dan Penyewaan Sepeda")
fig, ax = plt.subplots(figsize=(10, 6))
sns.scatterplot(data=filtered_df, x="temp", y="cnt", alpha=0.6, color="r", ax=ax)
ax.set_xlabel("Suhu Normalisasi (0-1)")
ax.set_ylabel("Jumlah Penyewaan")
st.pyplot(fig)

st.caption("ğŸš´â€â™‚ï¸ Dashboard ini dibuat menggunakan Streamlit")
